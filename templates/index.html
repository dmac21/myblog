{% extends "base.html" %}

{% block page_content %}
    <div style="width: 100%;height: 100%">
        <div class="col-md-12">
          <h1 class="my-4">
            {% if current_user.username %}
            <small>你好，{{ current_user.username }}</small>
            {% else %}
            <small>你好，陌生人</small>
            {% end %}
          </h1>
        </div>
        <header>
                <h5>近期文章</h5>
        </header>
        <!--<script type="text/javascript">-->
            <!--function test(){-->
                <!--var src = document.getElementById('text-input').value;-->
                <!--var converter = new showdown.Converter();-->
                <!--var html = converter.makeHtml(src);-->
                <!--$('#preview').html(html);-->
            <!--}-->
        <!--</script>-->
        <!--<div class="row" style="margin:0 auto;margin-bottom:50px; width: 100%;height: 50%">-->
            <!--<div class="col-lg-6">-->
                <!--<form action="/" method="post" style="width:100%;height:100%">-->
                    <!--<textarea id="text-input" name="post" placeholder="写下你的文章" style="width:100%;height:100%" oninput="test()" required></textarea>-->
                    <!--</br>-->
                    <!--<button class="btn btn-primary btn-sm" type="submit">发布</button>-->
                <!--</form>-->
            <!--</div>-->
            <!--<div class="col-lg-6">-->
            <!--<div id="preview" style="border:1px #1de877 solid ;width:100%;height:100%"> </div>-->
            <!--</div>-->
        <!--</div>-->
        <div class="col-md-12">
            <ul class="posts">
                {% for post in posts %}
                <li class="post">
                <div class="post-thumbnail">
                    <a><img class="img-rounded profile-thumbnail" src="{{ post.author.gravatar(size=40) }}"></a>
                </div>
                <div class="post-content">
                <div class="post-date">
                    <script>
                        moment.locale('zh-cn');
                        document.write(moment(moment.utc("{{ post.timestamp }}").toDate()).fromNow())
                    </script>
                </div>
                <div class="post-author">
                    {{ post.author.username }}
                </div>
                <div class="post-body">
                        {% raw post.title %}
                </div>
                <div class="post-footer">
                    <a href="/post/{{ post.id }}"><span class="badge badge-pill badge-danger">查看详情</span></a>
                </div>
                </div>
                </li>
                {% end %}
            </ul>
        </br>
              <ul class="pagination justify-content-end">
                  {% if current_page == 1 %}
                <li class="page-item disabled">
                  <a class="page-link" href="#">Previous</a>
                </li>
                  {% else %}
                <li class="page-item">
                  <a class="page-link" href="/?page={{ current_page-1 }}">Previous</a>
                </li>
                  {% end %}






          {% if total_page_count <= 10 %}
                  {% for p in range(1, total_page_count+2) %}
                      {% if p == current_page %}
                          <li class="page-item active"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                      {% else %}
                          <li class="page-item"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                      {% end %}
                  {% end %}
          {% else %}
                  {% if current_page > 10 %}
                      {% if current_page > total_page_count-8 %}
                          <li class="page-item"><a class="page-link" href="/?page=1">1</a></li>
                          <li class="page-item"><a class="page-link" href="/?page=2">2</a></li>
                          <li class="page-item disabled"><a class="page-link" href="#">&hellip;</a></li>
                          {% for p in range(current_page-2, current_page+4) %}
                              {% if p == current_page %}
                                  <li class="page-item active"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                              {% else %}
                                  <li class="page-item"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                              {% end %}
                          {% end %}
                      {% else %}
                          <li class="page-item"><a class="page-link" href="/?page=1">1</a></li>
                          <li class="page-item"><a class="page-link" href="/?page=2">2</a></li>
                          <li class="page-item disabled"><a class="page-link" href="#">&hellip;</a></li>
                          {% for p in range(current_page-2, current_page+4) %}
                              {% if p == current_page %}
                                  <li class="page-item active"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                              {% else %}
                                  <li class="page-item"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                              {% end %}
                          {% end %}
                          <li class="page-item disabled"><a class="page-link" href="#">&hellip;</a></li>
                          <li class="page-item"><a class="page-link" href="/?page={{ total_page_count }}">{{ total_page_count }}</a></li>
                          <li class="page-item"><a class="page-link" href="/?page={{ total_page_count+1 }}">{{ total_page_count+1 }}</a></li>
                      {% end %}
                  {% else %}
                      {% for p in range(1, 11) %}
                          {% if p == current_page %}
                              <li class="page-item active"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                          {% else %}
                              <li class="page-item"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                          {% end %}
                      {% end %}
                      <li class="page-item disabled"><a class="page-link" href="#">&hellip;</a></li>
                  {% end %}
          {% end %}



                  {% if current_page == total_page_count+1 %}
                <li class="page-item disabled">
                  <a class="page-link" href="#">Next</a>
                </li>
                  {% else %}
                <li class="page-item">
                  <a class="page-link" href="/?page={{ current_page+1 }}">Next</a>
                </li>
                  {% end %}
              </ul>
        </div>
    </div>
{% end %}
<!--{% autoescape None %}-->