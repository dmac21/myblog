{% extends "base.html" %}

{% block page_content %}
    <div class="container">
        <div class="col-md-12">
          <h1 class="my-4">
            {% if current_user.username %}
            <small>你好，{{ current_user.username }}</small>
            {% else %}
            <small>你好，陌生人</small>
            {% end %}
          </h1>
        </div>
        <div class="col-md-12">
            <form action="/" method="post">
                <p>写下你的文章</p>
                <textarea name="post" class="form-control" placeholder="写点什么" required></textarea>
                </br>
                <button class="btn btn-primary btn-sm" type="submit">发布</button>
            </form>
        </div>
        <div class="col-md-12">
            <ul class="posts">
                {% for post in posts %}
                <li class="post">
                <div class="post-thumbnail">
                    <a><img class="img-rounded profile-thumbnail" src="{{ post.author.gravatar(size=40) }}"></a>
                </div>
                <div class="post-content">
                <div class="post-date">
                    <script>
                        moment.locale('zh-cn');
                        document.write(moment(moment.utc("{{ post.timestamp }}").toDate()).fromNow())
                    </script>
                </div>
                <div class="post-author">
                    {{ post.author.username }}
                </div>
                <div class="post-body">
                    {{ post.body }}
                </div>
                </div>
                </li>
                {% end %}
            </ul>
        </br>
              <ul class="pagination justify-content-end">
                  {% if current_page == 1 %}
                <li class="page-item disabled">
                  <a class="page-link" href="#">Previous</a>
                </li>
                  {% else %}
                <li class="page-item">
                  <a class="page-link" href="/?page={{ current_page-1 }}">Previous</a>
                </li>
                  {% end %}






          {% if total_page_count <= 10 %}
                  {% for p in range(1, total_page_count+2) %}
                      {% if p == current_page %}
                          <li class="page-item active"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                      {% else %}
                          <li class="page-item"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                      {% end %}
                  {% end %}
          {% else %}
                  {% if current_page > 10 %}
                      {% if current_page > total_page_count-8 %}
                          <li class="page-item"><a class="page-link" href="/?page=1">1</a></li>
                          <li class="page-item"><a class="page-link" href="/?page=2">2</a></li>
                          <li class="page-item disabled"><a class="page-link" href="#">&hellip;</a></li>
                          {% for p in range(current_page-2, current_page+4) %}
                              {% if p == current_page %}
                                  <li class="page-item active"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                              {% else %}
                                  <li class="page-item"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                              {% end %}
                          {% end %}
                      {% else %}
                          <li class="page-item"><a class="page-link" href="/?page=1">1</a></li>
                          <li class="page-item"><a class="page-link" href="/?page=2">2</a></li>
                          <li class="page-item disabled"><a class="page-link" href="#">&hellip;</a></li>
                          {% for p in range(current_page-2, current_page+4) %}
                              {% if p == current_page %}
                                  <li class="page-item active"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                              {% else %}
                                  <li class="page-item"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                              {% end %}
                          {% end %}
                          <li class="page-item disabled"><a class="page-link" href="#">&hellip;</a></li>
                          <li class="page-item"><a class="page-link" href="/?page={{ total_page_count }}">{{ total_page_count }}</a></li>
                          <li class="page-item"><a class="page-link" href="/?page={{ total_page_count+1 }}">{{ total_page_count+1 }}</a></li>
                      {% end %}
                  {% else %}
                      {% for p in range(1, 11) %}
                          {% if p == current_page %}
                              <li class="page-item active"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                          {% else %}
                              <li class="page-item"><a class="page-link" href="/?page={{ p }}">{{ p }}</a></li>
                          {% end %}
                      {% end %}
                      <li class="page-item disabled"><a class="page-link" href="#">&hellip;</a></li>
                  {% end %}
          {% end %}



                  {% if current_page == total_page_count+1 %}
                <li class="page-item disabled">
                  <a class="page-link" href="#">Next</a>
                </li>
                  {% else %}
                <li class="page-item">
                  <a class="page-link" href="/?page={{ current_page+1 }}">Next</a>
                </li>
                  {% end %}
              </ul>
        </div>
    </div>
{% end %}